---
title: Individual Application - Florida Estates Phase 2
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Individual Application Form for Rio Tierra Real Estate developments. Apply to purchase premium residential lots in our exclusive communities.">
  <meta name="keywords" content="individual application, Rio Tierra, residential lots, real estate, Florida Estates, Lunar Estates">
  <meta name="author" content="Rio Tierra Real Estate">
  <meta property="og:title" content="Rio Tierra | Individual Application Form">
  <meta property="og:description" content="Apply to purchase premium residential lots in Rio Tierra Real Estate's exclusive developments.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="/Rio Tierra Logo.webp">
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#c1743c">
  <title>Rio Tierra | Individual Application Form</title>
  
  <link rel="preload" href="/Rio Tierra Logo.webp" as="image">
  <link rel="preconnect" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/footer.css">
  
  <script async src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <style>
    :root {
      --primary: #c1743c;
      --primary-dark: #a85e2d;
      --primary-light: #d4896b;
      --secondary: #2d4a8a;
      --text-dark: #1a1a1a;
      --text-medium: #4a4a4a;
      --text-light: #6b7280;
      --border-color: #e5e7eb;
      --border-light: #f3f4f6;
      --bg-light: #fafafa;
      --bg-white: #ffffff;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.12);
      --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      --border-radius: 8px;
      --border-radius-lg: 12px;
    }

    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      color: var(--text-dark);
      background-color: var(--bg-white);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
    }

    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: rgba(245, 241, 235, 0.95);
      border-bottom: 1px solid var(--border-color);
      padding: 0;
      box-shadow: var(--shadow-sm);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: var(--transition);
    }

    .navbar-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: transparent;
    }

    .navbar-brand {
      text-decoration: none;
      display: flex;
      align-items: center;
      transition: var(--transition);
    }

    .navbar-brand:hover {
      transform: translateY(-1px);
    }

    .navbar-logo {
      height: 45px;
      width: auto;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
    }

    .navbar-links {
      display: flex;
      list-style: none;
      gap: 48px;
      margin: 0;
      padding: 0;
      align-items: center;
    }

    .navbar-links a {
      text-decoration: none;
      color: var(--text-medium);
      font-weight: 500;
      font-size: 15px;
      transition: var(--transition);
      position: relative;
      padding: 12px 0;
      letter-spacing: 0.01em;
      min-height: 44px;
      min-width: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .navbar-links a:hover {
      color: var(--text-dark);
    }

    .navbar-links a.active {
      color: var(--text-dark);
      font-weight: 600;
      position: relative;
    }

    .navbar-links a.active::after {
      content: '';
      position: absolute;
      bottom: 0px;
      left: 0;
      right: 0;
      width: 100%;
      height: 2px;
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      border-radius: 1px;
    }

    .navbar-right {
      display: flex;
      align-items: center;
      gap: 24px;
    }

    .navbar-cta {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #ffffff;
      padding: 12px 28px;
      border-radius: var(--border-radius);
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: var(--transition);
      border: none;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
      letter-spacing: 0.01em;
      min-height: 44px;
      min-width: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .navbar-cta:hover {
      background: linear-gradient(135deg, var(--primary-dark), #955129);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
      color: #ffffff;
    }

    .navbar-cta:active {
      transform: translateY(0);
    }

    .mobile-menu-btn {
      display: none;
      flex-direction: column;
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 8px;
      transition: all 0.25s ease;
      min-height: 44px;
      min-width: 44px;
    }

    .mobile-menu-btn:hover {
      background: rgba(0, 0, 0, 0.05);
    }

    .mobile-menu-btn span {
      width: 24px;
      height: 2px;
      background: #1a1a1a;
      margin: 3px 0;
      transition: all 0.25s ease;
      border-radius: 1px;
    }

    .mobile-menu-btn.active span:nth-child(1) {
      transform: rotate(45deg) translate(5px, 5px);
    }

    .mobile-menu-btn.active span:nth-child(2) {
      opacity: 0;
    }

    .mobile-menu-btn.active span:nth-child(3) {
      transform: rotate(-45deg) translate(7px, -6px);
    }

    .form-section {
      padding: 120px 0 100px;
      min-height: calc(100vh - 200px);
      background: linear-gradient(135deg, var(--bg-light) 0%, #f8f9fa 100%);
    }

    .form-container {
      max-width: 1000px;
      margin: 0 auto;
      background: var(--bg-white);
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
      padding: 50px;
      width: 100%;
      border: 1px solid var(--border-light);
    }

    .form-header {
      text-align: center;
      margin-bottom: 40px;
      padding-bottom: 30px;
      border-bottom: 2px solid var(--border-light);
    }

    .form-header h1 {
      font-size: 2.75rem;
      color: var(--primary);
      margin-bottom: 20px;
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1.2;
    }

    /* Document Form Styles */
    @page {
      size: letter;
      margin: 0;
    }

    .page-container {
      width: 100%;
      background: #fff;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      position: relative;
      padding: 0.75in;
      margin: 0 auto;
      font-family: 'Times New Roman', Times, serif;
      color: #000;
      line-height: 1.3;
      font-size: 12pt;
    }

    .header-section {
      text-align: center;
      margin-bottom: 0.35in;
      position: relative;
    }

    .form-number {
      position: absolute;
      top: -0.5in;
      right: 0;
      font-size: 9pt;
      color: #666;
      font-family: Arial, sans-serif;
    }

    .main-title {
      font-size: 16pt;
      font-weight: bold;
      text-decoration: underline;
      letter-spacing: 0.5pt;
      margin-bottom: 0.25in;
    }

    .info-line {
      margin-bottom: 0.15in;
      display: flex;
      align-items: baseline;
      line-height: 1.8;
    }

    .label {
      font-weight: bold;
      margin-right: 0.1in;
    }

    .field-input {
      border: none;
      border-bottom: 1px solid #000;
      background: transparent;
      font-family: 'Times New Roman', Times, serif;
      font-size: 12pt;
      padding: 0 2px;
      margin: 0 0.05in;
      outline: none;
      display: inline-block;
      vertical-align: baseline;
      min-height: 44px;
    }

    .field-input:focus {
      background: rgba(255, 255, 240, 0.5);
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    .field-xs { width: 0.5in; }
    .field-s { width: 0.9in; }
    .field-m { width: 1.5in; }
    .field-l { width: 2.2in; }
    .field-xl { width: 3in; }
    .field-auto { min-width: 0.8in; flex: 1; }

    .buyer-table {
      width: 100%;
      border-collapse: collapse;
      border: 1.5pt solid #000;
      margin: 0.25in 0;
      table-layout: fixed;
    }

    .buyer-table td {
      padding: 0.08in 0.1in;
      vertical-align: top;
      width: 50%;
    }

    .buyer-table .section-header {
      font-weight: bold;
      text-align: center;
      text-decoration: underline;
      padding: 0.12in 0;
      font-size: 13pt;
    }

    .buyer-table .divider {
      border-right: 1pt solid #000;
    }

    .info-row {
      display: flex;
      align-items: baseline;
      margin-bottom: 0.12in;
      flex-wrap: wrap;
    }

    .info-label {
      font-weight: bold;
      margin-right: 0.08in;
      min-width: 0.55in;
      flex-shrink: 0;
    }

    .financial-table {
      width: 100%;
      border-collapse: collapse;
      border: 1.5pt solid #000;
      margin: 0.2in 0;
    }

    .financial-table td {
      border: 1pt solid #000;
      padding: 0.08in 0.12in;
    }

    .financial-table .label-cell {
      font-weight: bold;
      width: 40%;
      background: #f9f9f9;
    }

    .legal-box {
      border: 1.5pt solid #000;
      padding: 0.15in 0.2in;
      margin: 0.2in 0;
      font-size: 10pt;
      text-align: justify;
      line-height: 1.4;
    }

    .legal-box p {
      margin-bottom: 0.1in;
    }

    .legal-box p:last-child {
      margin-bottom: 0;
    }

    .signature-section {
      margin-top: 0.3in;
    }

    .signature-table {
      width: 100%;
      margin-top: 0.2in;
    }

    .signature-table td {
      padding: 0.05in 0.1in;
      vertical-align: bottom;
    }

    .signature-line {
      border-bottom: 1pt solid #000;
      min-height: 0.35in;
      display: inline-block;
      vertical-align: bottom;
      position: relative;
    }

    .signature-box {
      width: 2.5in;
      height: 0.4in;
      border-bottom: 1pt solid #000;
      display: inline-block;
      position: relative;
      cursor: pointer;
      vertical-align: bottom;
      min-height: 44px;
      min-width: 44px;
    }

    .signature-box:hover {
      background: rgba(240, 240, 255, 0.3);
    }

    .signature-box:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    .signature-placeholder {
      position: absolute;
      bottom: 0.05in;
      left: 0.1in;
      color: #666;
      font-size: 9pt;
      font-style: italic;
    }

    .signature-display {
      position: absolute;
      bottom: 0;
      left: 0.05in;
      right: 0.05in;
      height: 0.35in;
      display: flex;
      align-items: flex-end;
    }

    .typed-signature {
      font-family: 'Brush Script MT', 'Lucida Handwriting', cursive;
      font-size: 20pt;
      color: #000080;
    }

    .drawn-signature {
      max-height: 0.3in;
      max-width: 100%;
    }

    .footer-section {
      margin-top: 0.4in;
      padding-top: 0.15in;
      border-top: 0.5pt solid #999;
      font-size: 9pt;
      line-height: 1.3;
    }

    .control-panel {
      background: #f5f5f5;
      border-top: 2px solid #333;
      padding: 20px;
      text-align: center;
      margin-top: 20px;
    }

    .btn {
      background: #333;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 14px;
      cursor: pointer;
      margin: 0 5px;
      font-family: Arial, sans-serif;
      border-radius: 6px;
      min-height: 44px;
      min-width: 44px;
    }

    .btn:hover:not(:disabled) {
      background: #555;
    }

    .btn:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: white;
      color: #333;
      border: 2px solid #333;
    }

    .btn-secondary:hover {
      background: #f0f0f0;
    }

    .status-msg {
      margin: 15px 0;
      padding: 10px;
      display: none;
      border-radius: 4px;
    }

    .status-msg.show {
      display: block;
    }

    .status-msg.success {
      background: #d4edda;
      color: #155724;
    }

    .status-msg.error {
      background: #f8d7da;
      color: #721c24;
    }

    .status-msg.info {
      background: #d1ecf1;
      color: #0c5460;
    }

    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }

    .loading-overlay.active {
      display: flex;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #333;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      align-items: center;
      justify-content: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 5px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-title {
      font-size: 18pt;
      font-weight: bold;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24pt;
      cursor: pointer;
      padding: 0;
      color: #666;
      min-height: 44px;
      min-width: 44px;
    }

    .close-btn:hover {
      color: #000;
    }

    .close-btn:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    .tab-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px;
      border: 1px solid #ccc;
      background: white;
      cursor: pointer;
      min-height: 44px;
      min-width: 44px;
    }

    .tab-btn.active {
      background: #333;
      color: white;
    }

    .tab-btn:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    .tab-content {
      display: none;
      min-height: 220px;
    }

    .tab-content.active {
      display: block;
    }

    .type-input {
      width: 100%;
      padding: 15px;
      border: 1px solid #ccc;
      font-size: 24pt;
      text-align: center;
      font-family: 'Brush Script MT', cursive;
      color: #000080;
      min-height: 44px;
    }

    .type-input:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    .canvas-container {
      border: 2px solid #ccc;
      margin: 0 auto;
      display: block;
      background: white;
      cursor: crosshair;
      width: 100%;
      height: 180px;
      border-radius: 4px;
    }

    .canvas-container:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    .form-footer {
      margin-top: 40px;
      text-align: center;
      padding-top: 30px;
      border-top: 2px solid var(--border-light);
    }

    .form-footer p {
      color: var(--text-light);
      font-size: 1rem;
      font-weight: 400;
    }

    .form-footer a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
      min-height: 44px;
      min-width: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .form-footer a:hover {
      text-decoration: underline;
    }

    .form-footer a:focus {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    @media (max-width: 768px) {
      .navbar-container {
        padding: 15px 30px;
      }
      
      .navbar-links {
        position: fixed;
        top: 73px;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        flex-direction: column;
        padding: 30px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        transform: translateY(-100%);
        opacity: 0;
        visibility: hidden;
        transition: all 0.25s ease;
        gap: 25px;
      }
      
      .navbar-links.active {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
      }
      
      .navbar-links a.active::after {
        bottom: -8px;
      }
      
      .mobile-menu-btn {
        display: flex;
      }
      
      .navbar-cta {
        display: none;
      }

      .form-section {
        padding: 100px 0 70px;
      }
      
      .form-container {
        padding: 35px 25px;
        margin: 0 15px;
      }
      
      .form-header h1 {
        font-size: 2.25rem;
      }

      /* SIMPLE SCALING SOLUTION */
      .page-container {
        transform: scale(0.7);
        transform-origin: top left;
        width: 142.86%; /* 100% / 0.7 to compensate for scale */
        margin-bottom: -30%;
      }

      .control-panel {
        padding: 15px;
        margin-top: 15px;
      }

      .btn {
        padding: 12px 25px;
        font-size: 14px;
        margin: 5px;
      }

      .modal-content {
        width: 95%;
        margin: 20px;
        padding: 20px;
        max-height: 90vh;
      }

      .modal-title {
        font-size: 16pt;
      }

      .tab-content {
        min-height: 200px;
      }

      .type-input {
        font-size: 18pt;
        padding: 12px;
      }

      .canvas-container {
        width: 100%;
        height: 150px;
        border: 2px solid #333;
        background: #f9f9f9;
      }

      .tab-btn {
        padding: 12px;
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      .navbar-container {
        padding: 12px 20px;
      }
      
      .navbar-logo {
        height: 35px;
      }
      
      .navbar-links {
        top: 68px;
      }

      .form-section {
        padding: 85px 0 60px;
      }
      
      .form-container {
        padding: 25px 20px;
        margin: 0 10px;
      }
      
      .form-header h1 {
        font-size: 2rem;
      }

      /* SMALLER SCALE FOR TINY SCREENS */
      .page-container {
        transform: scale(0.5);
        transform-origin: top left;
        width: 200%; /* 100% / 0.5 to compensate for scale */
        margin-bottom: -50%;
      }

      .btn {
        padding: 15px;
        font-size: 16px;
        margin: 8px 0;
      }

      .modal-content {
        width: 98%;
        margin: 10px;
        padding: 15px;
        max-height: 90vh;
      }

      .modal-title {
        font-size: 14pt;
      }

      .tab-content {
        min-height: 180px;
      }

      .type-input {
        font-size: 16pt;
        padding: 10px;
      }

      .canvas-container {
        width: 100%;
        height: 130px;
        border: 2px solid #333;
      }

      .tab-btn {
        padding: 10px;
        font-size: 12px;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
      
      html {
        scroll-behavior: auto;
      }
    }

    @media print {
      body {
        background: white;
        margin: 0;
      }

      .navbar,
      .control-panel,
      .loading-overlay,
      .modal,
      .form-header,
      .form-footer {
        display: none !important;
      }

      .page-container {
        width: 100%;
        min-height: 100vh;
        margin: 0;
        box-shadow: none;
        padding: 0.75in;
        page-break-after: always;
      }

      .field-input {
        border-bottom: 1px solid #000 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .buyer-table,
      .financial-table,
      .legal-box {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .signature-box {
        border-bottom: 1px solid #000 !important;
      }
    }

    .field-input.error {
      background: #ffe0e0;
      border-bottom: 2px solid #d00;
    }
  </style>
</head>
<body>
  <nav class="navbar" role="navigation" aria-label="Main navigation">
    <div class="navbar-container">
      <a href="/" class="navbar-brand" aria-label="Rio Tierra Home">
        <img src="/Rio Tierra Logo.webp" 
             alt="Rio Tierra Logo" 
             class="navbar-logo" 
             width="65" 
             height="65"
             loading="eager"
             decoding="async">
      </a>
      <div class="navbar-links" role="menubar">
        <a href="/" role="menuitem">Home</a>
        <a href="/sales/" role="menuitem">Sales</a>
        <a href="#contact" class="active" role="menuitem" aria-current="page">Individual Application</a>
      </div>
      <div class="navbar-right">
        <a href="#contact" class="navbar-cta">Get In Touch</a>
        <button class="mobile-menu-btn" aria-label="Toggle mobile menu" aria-expanded="false" aria-controls="navbar-links">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
  </nav>

  <main>
    <section class="form-section" id="individual-application" aria-labelledby="form-heading">
      <div class="container">
        <div class="form-container">
          <header class="form-header">
            <h1 id="form-heading">Individual Application Form</h1>
          </header>
          <div class="loading-overlay" id="loadingOverlay" aria-label="Loading">
        <div class="spinner" aria-label="Loading spinner"></div>
    </div>

    <div class="page-container" id="documentPage">
        <div class="form-number"></div>
        
        <header class="header-section">
            <h2 class="main-title">OFFER TO PURCHASE VACANT PROPERTY</h2>
        </header>

        <form id="purchaseForm" novalidate>
            <div class="info-line">
                <span class="label">Seller:</span>
                <span>SNT RGV, LLC, P.O. Box 610, McAllen, Texas 78505</span>
            </div>

            <div class="info-line">
                <label for="lot" class="label">Lot#</label>
                <input type="text" class="field-input field-xs" id="lot" name="lot" required aria-describedby="lot-error">
                
                <label for="block" class="label" style="margin-left: 0.3in;">Block#</label>
                <input type="text" class="field-input field-xs" id="block" name="block" required aria-describedby="block-error">
                
                <span class="label" style="margin-left: 0.3in;">Subdivision:</span>
                <span>Florida Estates Subdivision Section II, Cameron County, TX</span>
            </div>

            <table class="buyer-table" role="table" aria-label="Buyer and Co-Buyer Information">
                <tr>
                    <td class="section-header divider" colspan="2">Buyer</td>
                    <td class="section-header" colspan="2">Co-Buyer</td>
                </tr>
                <tr>
                    <td colspan="2" class="divider" style="padding: 0.15in;">
                        <div class="info-row">
                            <label for="buyerName" class="info-label">Name:</label>
                            <input type="text" class="field-input field-l" id="buyerName" name="buyerName" required aria-describedby="buyerName-error">
                        </div>
                        <div class="info-row">
                            <label for="buyerEmail" class="info-label">Email:</label>
                            <input type="email" class="field-input field-l" id="buyerEmail" name="buyerEmail" required aria-describedby="buyerEmail-error">
                        </div>
                        <div class="info-row">
                            <label for="buyerAddress" class="info-label">Address:</label>
                            <input type="text" class="field-input field-l" id="buyerAddress" name="buyerAddress" required aria-describedby="buyerAddress-error">
                        </div>
                        <div class="info-row">
                            <label for="buyerCity" class="info-label">City:</label>
                            <input type="text" class="field-input field-m" id="buyerCity" name="buyerCity" required aria-describedby="buyerCity-error">
                        </div>
                        <div class="info-row">
                            <label for="buyerState" class="info-label">State:</label>
                            <input type="text" class="field-input field-xs" id="buyerState" name="buyerState" maxlength="2" required aria-describedby="buyerState-error">
                            <label for="buyerZip" class="info-label" style="margin-left: 0.1in;">ZIP:</label>
                            <input type="text" class="field-input field-s" id="buyerZip" name="buyerZip" required aria-describedby="buyerZip-error">
                        </div>
                        <div class="info-row">
                            <label for="buyerPhone" class="info-label">Phone:</label>
                            <input type="tel" class="field-input field-m" id="buyerPhone" name="buyerPhone" required aria-describedby="buyerPhone-error">
                        </div>
                        <div class="info-row">
                            <label for="buyerSSN" class="info-label">SSN:</label>
                            <input type="text" class="field-input field-m" id="buyerSSN" name="buyerSSN" placeholder="000-00-0000" required aria-describedby="buyerSSN-error">
                        </div>
                    </td>
                    <td colspan="2" style="padding: 0.15in;">
                        <div class="info-row">
                            <label for="cobuyerName" class="info-label">Name:</label>
                            <input type="text" class="field-input field-l" id="cobuyerName" name="cobuyerName">
                        </div>
                        <div class="info-row">
                            <label for="cobuyerEmail" class="info-label">Email:</label>
                            <input type="email" class="field-input field-l" id="cobuyerEmail" name="cobuyerEmail">
                        </div>
                        <div class="info-row">
                            <label for="cobuyerAddress" class="info-label">Address:</label>
                            <input type="text" class="field-input field-l" id="cobuyerAddress" name="cobuyerAddress">
                        </div>
                        <div class="info-row">
                            <label for="cobuyerCity" class="info-label">City:</label>
                            <input type="text" class="field-input field-m" id="cobuyerCity" name="cobuyerCity">
                        </div>
                        <div class="info-row">
                            <label for="cobuyerState" class="info-label">State:</label>
                            <input type="text" class="field-input field-xs" id="cobuyerState" name="cobuyerState" maxlength="2">
                            <label for="cobuyerZip" class="info-label" style="margin-left: 0.1in;">ZIP:</label>
                            <input type="text" class="field-input field-s" id="cobuyerZip" name="cobuyerZip">
                        </div>
                        <div class="info-row">
                            <label for="cobuyerPhone" class="info-label">Phone:</label>
                            <input type="tel" class="field-input field-m" id="cobuyerPhone" name="cobuyerPhone">
                        </div>
                        <div class="info-row">
                            <label for="cobuyerSSN" class="info-label">SSN:</label>
                            <input type="text" class="field-input field-m" id="cobuyerSSN" name="cobuyerSSN" placeholder="000-00-0000">
                        </div>
                    </td>
                </tr>
            </table>

            <table class="financial-table" role="table" aria-label="Financial Information">
                <tr>
                    <td class="label-cell"><label for="purchasePrice">Purchase Price:</label></td>
                    <td>$ <input type="number" class="field-input field-m" id="purchasePrice" name="purchasePrice" step="0.01" required aria-describedby="purchasePrice-error"></td>
                </tr>
                <tr>
                    <td class="label-cell"><label for="downPayment">Down Payment:</label></td>
                    <td>$ <input type="number" class="field-input field-m" id="downPayment" name="downPayment" step="0.01" required aria-describedby="downPayment-error"></td>
                </tr>
                <tr>
                    <td class="label-cell"><label for="loanAmount">Amount to Finance:</label></td>
                    <td>$ <input type="number" class="field-input field-m" id="loanAmount" name="loanAmount" readonly aria-label="Amount to finance, calculated automatically"></td>
                </tr>
                <tr>
                    <td class="label-cell">Interest Rate:</td>
                    <td><strong>10.00%</strong> per annum</td>
                </tr>
                <tr>
                    <td class="label-cell">Term of Loan:</td>
                    <td>
                        <label for="termMonths" class="sr-only">Term in months</label>
                        <input type="number" class="field-input field-xs" id="termMonths" name="termMonths" required aria-describedby="termMonths-error"> months
                        (<label for="termYears" class="sr-only">Term in years</label><input type="number" class="field-input field-xs" id="termYears" name="termYears" aria-label="Years calculated from months"> years)
                    </td>
                </tr>
            </table>

            <section class="legal-box" aria-labelledby="legal-terms">
                <h3 id="legal-terms" class="sr-only">Legal Terms and Conditions</h3>
                <p>An Owner's Title Insurance Policy is not provided in this sale. Buyer may obtain a Title Insurance Policy at Buyer's expense from a title company of Buyer's choice.</p>
                
                <p>Buyer is offering to purchase the property described herein "AS IS" in its present condition. The Property is subject to certain restrictions which Buyer acknowledges having received a copy of.</p>
                
                <p>The documents signed at the closing of the sale and purchase will contain the entire agreement. Any promise or representation by any salesperson or employee of the Seller in writing or orally that is different than the documents signed at the closing is void. Any dispute between Seller and Buyer related to this agreement which is not resolved through informal discussion will be referred to a mutually acceptable mediation service or provider. The parties to the mediation shall bear the mediation cost equally.</p>
                
                <p>Notice Regarding Possible Annexation: If the property that is the subject of this Contract is located outside the limits of a municipality, the property may now or later be included in the extraterritorial jurisdiction of a municipality and may now or later be subject to annexation by the municipality. Each municipality maintains a map that depicts its boundaries and extraterritorial jurisdiction. To determine if the property is located within a municipality's extraterritorial jurisdiction or is likely to be located within a municipality's extraterritorial jurisdiction, contact all municipalities located in the general proximity of the property for futher information.</p>
            </section>

            <section class="signature-section" aria-labelledby="signatures">
                <h3 id="signatures" class="sr-only">Signatures</h3>
                <table class="signature-table" role="table" aria-label="Signature Information">
                    <tr>
                        <td style="width: 15%;">Buyer:</td>
                        <td style="width: 40%;">
                            <button type="button" class="signature-box" id="buyerSignatureBox" tabindex="0" aria-label="Click to add buyer signature">
                                <span class="signature-placeholder">Click here to sign</span>
                                <div class="signature-display" id="buyerSignatureDisplay" aria-label="Buyer signature display"></div>
                            </button>
                        </td>
                        <td style="width: 45%; text-align: center; vertical-align: middle;" rowspan="3">
                            <div style="text-align: center;">
                                <label for="sellerAcceptanceDate" style="font-size: 9pt; font-weight: bold; display: block; margin-bottom: 0.1in;">Date Accepted by Seller<br>(Office use only)</label>
                                <input type="text" class="field-input field-m" id="sellerAcceptanceDate" name="sellerAcceptanceDate" readonly style="text-align: center; background: #f9f9f9; border-bottom: 1px solid #000;">
                            </div>
                        </td>
                    </tr>
                    <tr style="height: 0.15in;"></tr>
                    <tr>
                        <td>Co-Buyer:</td>
                        <td>
                            <button type="button" class="signature-box" id="cobuyerSignatureBox" tabindex="0" aria-label="Click to add co-buyer signature">
                                <span class="signature-placeholder">Click here to sign</span>
                                <div class="signature-display" id="cobuyerSignatureDisplay" aria-label="Co-buyer signature display"></div>
                            </button>
                        </td>
                    </tr>
                </table>
            </section>

            <footer class="footer-section">
                <p>Residential Mortgage Loan by: South Texas Origination and Mortgage, LLC</p>
                <p>1308 E. Jasmine Avenue, McAllen, Texas 78501</p>
                  <p>956.330.3859 NMLS# 1974725</p>
            </footer>

            <input type="hidden" id="buyerSignatureData" name="buyerSignatureData">
            <input type="hidden" id="cobuyerSignatureData" name="cobuyerSignatureData">
        </form>
    </div>

    <div class="control-panel">
        <div id="statusMsg" class="status-msg" role="status" aria-live="polite"></div>
        <button type="button" class="btn" id="submitBtn" aria-describedby="statusMsg">Submit Application</button>
        <div id="successBtns" style="display: none; margin-top: 15px;">
            <button type="button" class="btn btn-secondary" id="downloadBtn">Download PDF</button>
            <button type="button" class="btn btn-secondary" id="printBtn">Print Document</button>
        </div>
    </div>

    <!-- Signature Modal -->
    <div id="signatureModal" class="modal" role="dialog" aria-labelledby="signatureModalTitle" aria-modal="true">
        <div class="modal-content">
            <header class="modal-header">
                <h2 class="modal-title" id="signatureModalTitle">Add Signature</h2>
                <button class="close-btn" id="closeModal" aria-label="Close signature modal">&times;</button>
            </header>
            
            <div class="tab-buttons" role="tablist" aria-label="Signature input methods">
                <button class="tab-btn active" id="typeTab" role="tab" aria-selected="true" aria-controls="typeContent">Type</button>
                <button class="tab-btn" id="drawTab" role="tab" aria-selected="false" aria-controls="drawContent">Draw</button>
            </div>
            
            <div id="typeContent" class="tab-content active" role="tabpanel" aria-labelledby="typeTab">
                <label for="signatureTypeInput" class="sr-only">Type your signature</label>
                <input type="text" class="type-input" id="signatureTypeInput" placeholder="Type your signature" aria-label="Type your signature here">
            </div>
            
            <div id="drawContent" class="tab-content" role="tabpanel" aria-labelledby="drawTab">
                <canvas id="signatureCanvas" class="canvas-container" width="400" height="150" aria-label="Draw your signature here" tabindex="0"></canvas>
            </div>
            
            <div style="margin-top: 20px; text-align: right;">
                <button class="btn btn-secondary" id="clearBtn" style="margin-right: 10px;">Clear</button>
                <button class="btn" id="saveBtn">Save</button>
            </div>
        </div>
    </div>

          <footer class="form-footer">
            <p>Need assistance? <a href="#contact">Contact our team</a> for help with your application.</p>
          </footer>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="footer-top">
      <div class="container">
        <div class="footer-grid">
          <div class="footer-about">
            <div class="footer-logo">
              <img src="/Rio Tierra Logo.webp" alt="Rio Tierra Logo" width="70" height="70" loading="lazy" decoding="async">
            </div>
            <p class="footer-desc">Rio Tierra Real Estate specializes in creating exceptional communities with a focus on quality, sustainability, and innovative design.</p>
          </div>
          <div class="footer-links-container">
            <h4 class="footer-title">Quick Links</h4>
            <ul class="footer-links">
              <li><a href="/">Home</a></li>
              <li><a href="/sales/">Sales</a></li>
              <li><a href="#contact">Contact</a></li>
            </ul>
          </div>
          <div class="footer-links-container">
            <h4 class="footer-title">Our Communities</h4>
            <ul class="footer-links">
              <li><a href="/Lunar-Estates-1/">Lunar Estates - Phase 1</a></li>
              <li><a href="/Lunar-Estates-2/">Lunar Estates - Phase 2</a></li>
              <li><a href="/Florida-Estates-2/">Florida Estates - Phase 2</a></li>
              <li><a href="FEP3.html">Florida Estates - Phase 3</a></li>
              <li><a href="PGP3S1.html">Palmetto Grove - P3S1</a></li>
            </ul>
          </div>
          <div class="footer-contact">
            <h4 class="footer-title">Contact Info</h4>
            <div class="contact-info">
              <i class="fas fa-envelope contact-icon" aria-hidden="true"></i>
              <p>info@riotierra.com</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <div class="container">
        <div class="footer-bottom-content">
          <p class="copyright">&copy; 2025 Rio Tierra Real Estate. All rights reserved.</p>
        </div>
      </div>
    </div>
    <button id="back-to-top" class="back-to-top-btn" aria-label="Back to top">
      <i class="fas fa-chevron-up" aria-hidden="true"></i>
    </button>
  </footer>
  <script>
    // UPDATED BACKEND URL - Your actual Render URL
    const BACKEND_URL = 'https://holand-pdf-storage.onrender.com';

    // Initialize EmailJS
    emailjs.init('YvkwnfiMmHhEc2zjh');

    // Mobile menu functionality
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
      const navbarLinks = document.querySelector('.navbar-links');
      
      if (mobileMenuBtn && navbarLinks) {
        mobileMenuBtn.addEventListener('click', function() {
          const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
          
          mobileMenuBtn.classList.toggle('active');
          navbarLinks.classList.toggle('active');
          
          mobileMenuBtn.setAttribute('aria-expanded', !isExpanded);
        });
        
        document.addEventListener('click', function(e) {
          if (!mobileMenuBtn.contains(e.target) && !navbarLinks.contains(e.target)) {
            mobileMenuBtn.classList.remove('active');
            navbarLinks.classList.remove('active');
            mobileMenuBtn.setAttribute('aria-expanded', 'false');
          }
        });
        
        navbarLinks.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            mobileMenuBtn.classList.remove('active');
            navbarLinks.classList.remove('active');
            mobileMenuBtn.setAttribute('aria-expanded', 'false');
            mobileMenuBtn.focus();
          }
        });
      }

      initializeCanvas();
    });

    // Form functionality
    const form = document.getElementById('purchaseForm');
    const submitBtn = document.getElementById('submitBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const printBtn = document.getElementById('printBtn');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const statusMsg = document.getElementById('statusMsg');
    const successBtns = document.getElementById('successBtns');

    // Modal elements
    const modal = document.getElementById('signatureModal');
    const closeModal = document.getElementById('closeModal');
    const typeTab = document.getElementById('typeTab');
    const drawTab = document.getElementById('drawTab');
    const typeContent = document.getElementById('typeContent');
    const drawContent = document.getElementById('drawContent');
    const signatureTypeInput = document.getElementById('signatureTypeInput');
    const signatureCanvas = document.getElementById('signatureCanvas');
    const clearBtn = document.getElementById('clearBtn');
    const saveBtn = document.getElementById('saveBtn');

    // Signature boxes
    const buyerSigBox = document.getElementById('buyerSignatureBox');
    const cobuyerSigBox = document.getElementById('cobuyerSignatureBox');

    // State variables
    let currentSigTarget = null;
    let ctx = null;
    let isDrawing = false;
    let generatedPDF = null;
    let permanentPdfUrl = null;

    // Set today's date for submission
    const today = new Date();
    const dateStr = `${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getDate().toString().padStart(2, '0')}/${today.getFullYear()}`;

    // FIXED: Canvas initialization with proper mobile support - WIDER for signatures
    function initializeCanvas() {
      if (signatureCanvas) {
        // Set explicit canvas dimensions - MUCH WIDER for horizontal signatures
        const containerWidth = signatureCanvas.parentElement.offsetWidth;
        const canvasWidth = Math.max(500, containerWidth - 20); // Much wider, minimum 500px
        const canvasHeight = 180; // Reasonable height for signatures
        
        signatureCanvas.width = canvasWidth;
        signatureCanvas.height = canvasHeight;
        signatureCanvas.style.width = '100%'; // Fill container width
        signatureCanvas.style.height = canvasHeight + 'px';
        
        ctx = signatureCanvas.getContext('2d');
        ctx.lineWidth = 3; // Slightly thicker line for better visibility
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#000080';
        
        // Set white background
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, signatureCanvas.width, signatureCanvas.height);
        ctx.fillStyle = '#000080';
        
        console.log(`Canvas initialized: ${canvasWidth}x${canvasHeight}`);
      }
    }

    // FIXED: Canvas drawing setup
    function setupCanvasDrawing() {
      if (!signatureCanvas || !ctx) return;

      // Mouse events
      signatureCanvas.addEventListener('mousedown', startDrawing);
      signatureCanvas.addEventListener('mousemove', draw);
      signatureCanvas.addEventListener('mouseup', stopDrawing);
      signatureCanvas.addEventListener('mouseout', stopDrawing);

      // Touch events
      signatureCanvas.addEventListener('touchstart', handleTouch);
      signatureCanvas.addEventListener('touchmove', handleTouch);
      signatureCanvas.addEventListener('touchend', stopDrawing);

      // Keyboard events for accessibility
      signatureCanvas.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          // Focus on clear or save button for keyboard users
          clearBtn.focus();
        }
      });
    }

    function startDrawing(e) {
      isDrawing = true;
      const rect = signatureCanvas.getBoundingClientRect();
      const x = (e.clientX - rect.left) * (signatureCanvas.width / rect.width);
      const y = (e.clientY - rect.top) * (signatureCanvas.height / rect.height);
      
      ctx.beginPath();
      ctx.moveTo(x, y);
    }

    function draw(e) {
      if (!isDrawing) return;
      
      const rect = signatureCanvas.getBoundingClientRect();
      const x = (e.clientX - rect.left) * (signatureCanvas.width / rect.width);
      const y = (e.clientY - rect.top) * (signatureCanvas.height / rect.height);
      
      ctx.lineTo(x, y);
      ctx.stroke();
    }

    function stopDrawing() {
      isDrawing = false;
      ctx.beginPath();
    }

    function handleTouch(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                       e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
        clientX: touch.clientX,
        clientY: touch.clientY
      });
      signatureCanvas.dispatchEvent(mouseEvent);
    }

    // Modal functions with better mobile support
    function openModal(target) {
      currentSigTarget = target;
      modal.classList.add('active');
      signatureTypeInput.value = '';
      
      // Focus management for accessibility
      setTimeout(() => {
        if (typeContent.classList.contains('active')) {
          signatureTypeInput.focus();
        } else {
          signatureCanvas.focus();
        }
      }, 100);
      
      // Wait for modal to render, then initialize canvas
      setTimeout(() => {
        initializeCanvas();
        setupCanvasDrawing();
        if (ctx) {
          ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
          ctx.fillStyle = 'white';
          ctx.fillRect(0, 0, signatureCanvas.width, signatureCanvas.height);
          ctx.fillStyle = '#000080';
        }
      }, 200); // Longer delay for mobile
    }

    function closeModalFn() {
      modal.classList.remove('active');
      currentSigTarget = null;
      // Return focus to the signature box that opened the modal
      if (currentSigTarget) {
        currentSigTarget.focus();
      }
    }

    // Event listeners
    closeModal.addEventListener('click', closeModalFn);
    modal.addEventListener('click', (e) => {
      if (e.target === modal) closeModalFn();
    });

    // Escape key to close modal
    modal.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModalFn();
      }
    });

    // Tab switching
    typeTab.addEventListener('click', () => {
      typeTab.classList.add('active');
      drawTab.classList.remove('active');
      typeContent.classList.add('active');
      drawContent.classList.remove('active');
      typeTab.setAttribute('aria-selected', 'true');
      drawTab.setAttribute('aria-selected', 'false');
      signatureTypeInput.focus();
    });

    drawTab.addEventListener('click', () => {
      drawTab.classList.add('active');
      typeTab.classList.remove('active');
      drawContent.classList.add('active');
      typeContent.classList.remove('active');
      drawTab.setAttribute('aria-selected', 'true');
      typeTab.setAttribute('aria-selected', 'false');
      
      // Longer delay for mobile to ensure proper rendering
      setTimeout(() => {
        initializeCanvas();
        setupCanvasDrawing();
        signatureCanvas.focus();
      }, 150);
    });

    // Clear and save signature
    clearBtn.addEventListener('click', () => {
      if (typeContent.classList.contains('active')) {
        signatureTypeInput.value = '';
        signatureTypeInput.focus();
      } else {
        if (ctx) {
          ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
          ctx.fillStyle = 'white';
          ctx.fillRect(0, 0, signatureCanvas.width, signatureCanvas.height);
          ctx.fillStyle = '#000080';
        }
        signatureCanvas.focus();
      }
    });

    saveBtn.addEventListener('click', () => {
      if (!currentSigTarget) return;
      
      const display = currentSigTarget.querySelector('.signature-display');
      const placeholder = currentSigTarget.querySelector('.signature-placeholder');
      const dataField = currentSigTarget.id.includes('buyer') ? 
        document.getElementById('buyerSignatureData') : 
        document.getElementById('cobuyerSignatureData');
      
      if (typeContent.classList.contains('active') && signatureTypeInput.value.trim()) {
        display.innerHTML = `<span class="typed-signature">${signatureTypeInput.value}</span>`;
        dataField.value = signatureTypeInput.value;
        placeholder.style.display = 'none';
        // Update aria-label to indicate signature is present
        currentSigTarget.setAttribute('aria-label', 'Signature added - click to change');
      } else if (drawContent.classList.contains('active') && ctx) {
        const imageData = signatureCanvas.toDataURL();
        const img = document.createElement('img');
        img.src = imageData;
        img.className = 'drawn-signature';
        img.alt = 'Drawn signature';
        display.innerHTML = '';
        display.appendChild(img);
        dataField.value = imageData;
        placeholder.style.display = 'none';
        // Update aria-label to indicate signature is present
        currentSigTarget.setAttribute('aria-label', 'Signature added - click to change');
      }
      
      closeModalFn();
    });

    // Signature box handlers
    buyerSigBox.addEventListener('click', () => openModal(buyerSigBox));
    cobuyerSigBox.addEventListener('click', () => openModal(cobuyerSigBox));

    buyerSigBox.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        openModal(buyerSigBox);
      }
    });

    cobuyerSigBox.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        openModal(cobuyerSigBox);
      }
    });

    // Financial calculations
    const purchasePrice = document.getElementById('purchasePrice');
    const downPayment = document.getElementById('downPayment');
    const loanAmount = document.getElementById('loanAmount');
    const termMonths = document.getElementById('termMonths');
    const termYears = document.getElementById('termYears');

    function calculateLoan() {
      const price = parseFloat(purchasePrice.value) || 0;
      const down = parseFloat(downPayment.value) || 0;
      loanAmount.value = (price - down).toFixed(2);
    }

    purchasePrice.addEventListener('input', calculateLoan);
    downPayment.addEventListener('input', calculateLoan);

    termMonths.addEventListener('input', function() {
      const months = parseInt(this.value) || 0;
      termYears.value = (months / 12).toFixed(1);
    });

    termYears.addEventListener('input', function() {
      const years = parseFloat(this.value) || 0;
      termMonths.value = Math.round(years * 12);
    });

    // Phone and SSN formatting
    document.querySelectorAll('input[type="tel"]').forEach(input => {
      input.addEventListener('input', function() {
        let value = this.value.replace(/\D/g, '');
        if (value.length >= 6) {
          value = value.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
        } else if (value.length >= 3) {
          value = value.replace(/(\d{3})(\d{0,3})/, '($1) $2');
        }
        this.value = value;
      });
    });

    document.querySelectorAll('input[id*="SSN"]').forEach(input => {
      input.addEventListener('input', function() {
        let value = this.value.replace(/\D/g, '');
        if (value.length >= 5) {
          value = value.replace(/(\d{3})(\d{2})(\d{0,4})/, '$1-$2-$3');
        } else if (value.length >= 3) {
          value = value.replace(/(\d{3})(\d{0,2})/, '$1-$2');
        }
        this.value = value;
      });
    });

    // Form validation
    function validateForm() {
      const required = [
        'lot', 'block', 'buyerName', 'buyerEmail', 'buyerAddress',
        'buyerCity', 'buyerState', 'buyerZip', 'buyerPhone', 'buyerSSN',
        'purchasePrice', 'downPayment', 'termMonths'
      ];
      
      let valid = true;
      
      document.querySelectorAll('.field-input').forEach(input => {
        input.classList.remove('error');
      });
      
      required.forEach(id => {
        const field = document.getElementById(id);
        if (!field.value || field.value.trim() === '') {
          field.classList.add('error');
          field.setAttribute('aria-invalid', 'true');
          valid = false;
        } else {
          field.setAttribute('aria-invalid', 'false');
        }
      });
      
      const email = document.getElementById('buyerEmail');
      if (email.value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email.value)) {
        email.classList.add('error');
        email.setAttribute('aria-invalid', 'true');
        valid = false;
      }
      
      if (!document.getElementById('buyerSignatureData').value) {
        showStatus('Please add your signature before submitting.', 'error');
        valid = false;
      }
      
      return valid;
    }

    // Status message display
    function showStatus(msg, type) {
      statusMsg.textContent = msg;
      statusMsg.className = `status-msg ${type} show`;
    }

    // PDF generation with optimized settings for better text quality
    async function generatePDF() {
      try {
        const controlPanel = document.querySelector('.control-panel');
        const formHeader = document.querySelector('.form-header');
        const formFooter = document.querySelector('.form-footer');
        
        controlPanel.style.display = 'none';
        formHeader.style.display = 'none';
        formFooter.style.display = 'none';
        
        if (typeof html2canvas === 'undefined' || typeof window.jspdf === 'undefined') {
          await new Promise(resolve => setTimeout(resolve, 1000));
        }
        
        // FIXED: Better settings for text quality
        const element = document.getElementById('documentPage');
        
        // Get the actual dimensions
        const rect = element.getBoundingClientRect();
        const actualWidth = rect.width;
        const actualHeight = rect.height;
        
        const options = {
          scale: 2, // Higher scale for better text quality
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#ffffff',
          logging: false,
          letterRendering: true,
          width: actualWidth, // Use actual dimensions
          height: actualHeight,
          onclone: function(clonedDoc) {
            // Ensure fonts are loaded in the cloned document
            const clonedElement = clonedDoc.getElementById('documentPage');
            if (clonedElement) {
              clonedElement.style.fontFamily = '"Times New Roman", Times, serif';
            }
          }
        };
        
        const canvas = await html2canvas(element, options);
        
        controlPanel.style.display = 'block';
        formHeader.style.display = 'block';
        formFooter.style.display = 'block';
        
        const { jsPDF } = window.jspdf;
        
        // Calculate proper dimensions to maintain aspect ratio
        const imgWidth = canvas.width;
        const imgHeight = canvas.height;
        const ratio = imgHeight / imgWidth;
        
        // Standard letter size: 8.5" x 11"
        const pdfWidth = 8.5;
        const pdfHeight = 11;
        
        // Calculate scaled dimensions to fit within page while maintaining ratio
        let scaledWidth = pdfWidth;
        let scaledHeight = pdfWidth * ratio;
        
        if (scaledHeight > pdfHeight) {
          scaledHeight = pdfHeight;
          scaledWidth = pdfHeight / ratio;
        }
        
        // Center the content on the page
        const offsetX = (pdfWidth - scaledWidth) / 2;
        const offsetY = (pdfHeight - scaledHeight) / 2;
        
        const pdf = new jsPDF({
          orientation: 'portrait',
          unit: 'in',
          format: 'letter',
          compress: true
        });
        
        // FIXED: Use PNG for better text quality and proper scaling
        const imgData = canvas.toDataURL('image/png');
        pdf.addImage(imgData, 'PNG', offsetX, offsetY, scaledWidth, scaledHeight);
        
        return pdf;
        
      } catch (error) {
        console.error('PDF generation error:', error);
        throw error;
      }
    }

    // BACKEND INTEGRATION: Upload PDF to S3 with better error handling
    async function uploadPDFToBackend(pdf) {
      try {
        showStatus('Saving PDF permanently...', 'info');
        
        // IMPROVED: Get PDF as blob first, then convert to base64
        const pdfBlob = pdf.output('blob');
        console.log(`PDF blob size: ${pdfBlob.size} bytes (${(pdfBlob.size / 1024 / 1024).toFixed(2)} MB)`);
        
        // Convert blob to base64
        const base64Data = await new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(pdfBlob);
        });
        
        const buyerName = document.getElementById('buyerName').value;
        const originalName = `Purchase_Agreement_${buyerName.replace(/\s+/g, '_')}_${dateStr.replace(/\//g, '-')}.pdf`;
        
        console.log('Uploading to backend...');
        const response = await fetch(`${BACKEND_URL}/upload-pdf-base64`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            pdfData: base64Data,
            buyerName: buyerName,
            originalName: originalName
          })
        });
        
        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          console.error('Upload failed:', errorData);
          throw new Error(`Upload failed: ${response.status} - ${errorData.error || 'Unknown error'}`);
        }
        
        const result = await response.json();
        console.log('Upload successful:', result);
        return result.url;
        
      } catch (error) {
        console.error('Backend upload error:', error);
        throw new Error(`Failed to save PDF permanently: ${error.message}`);
      }
    }

    // MAIN FORM SUBMISSION
    submitBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      
      if (!validateForm()) return;
      
      loadingOverlay.classList.add('active');
      submitBtn.disabled = true;
      
      try {
        // Step 1: Generate PDF
        showStatus('Generating PDF...', 'info');
        generatedPDF = await generatePDF();
        
        // Step 2: Upload to backend
        permanentPdfUrl = await uploadPDFToBackend(generatedPDF);
        
        // Step 3: Send email with PDF link
        showStatus('Sending email...', 'info');
        const emailData = {
          buyer_name: document.getElementById('buyerName').value,
          buyer_email: document.getElementById('buyerEmail').value,
          lot_number: document.getElementById('lot').value,
          block_number: document.getElementById('block').value,
          purchase_price: document.getElementById('purchasePrice').value,
          submission_date: dateStr,
          pdf_link: permanentPdfUrl
        };
        
        await emailjs.send('service_vu3hz9m', 'template_t6sxp4j', emailData);
        
        // Success!
        loadingOverlay.classList.remove('active');
        showStatus('Application submitted successfully! PDF saved permanently and email sent.', 'success');
        
        submitBtn.style.display = 'none';
        if (successBtns) {
          successBtns.style.display = 'flex';
          successBtns.style.justifyContent = 'center';
          successBtns.style.gap = '10px';
        }
        
      } catch (error) {
        loadingOverlay.classList.remove('active');
        submitBtn.disabled = false;
        showStatus(`Submission failed: ${error.message}`, 'error');
        console.error('Submission error:', error);
      }
    });

    // Download PDF with Chrome-specific fixes
    downloadBtn.addEventListener('click', async () => {
      if (permanentPdfUrl) {
        try {
          // Chrome-specific: Use fetch with credentials
          const response = await fetch(permanentPdfUrl, {
            method: 'GET',
            credentials: 'omit', // Avoid CORS issues
            cache: 'no-cache'
          });
          
          if (response.ok) {
            const blob = await response.blob();
            
            // Chrome-friendly download method
            if (window.navigator && window.navigator.msSaveOrOpenBlob) {
              // IE/Edge fallback
              window.navigator.msSaveOrOpenBlob(blob, `Purchase_Agreement_${document.getElementById('buyerName').value.replace(/\s+/g, '_')}_${dateStr.replace(/\//g, '-')}.pdf`);
            } else {
              // Modern browsers (Chrome-optimized)
              const url = window.URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.style.display = 'none';
              a.href = url;
              a.download = `Purchase_Agreement_${document.getElementById('buyerName').value.replace(/\s+/g, '_')}_${dateStr.replace(/\//g, '-')}.pdf`;
              
              // Chrome requires the element to be in DOM
              document.body.appendChild(a);
              a.click();
              
              // Cleanup
              setTimeout(() => {
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
              }, 100);
            }
            showStatus('PDF downloaded successfully!', 'success');
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        } catch (error) {
          console.log('Direct download failed, trying popup method:', error);
          
          // Fallback: Create a user-initiated popup
          const popupFeatures = 'width=800,height=600,scrollbars=yes,resizable=yes';
          const popup = window.open('', '_blank', popupFeatures);
          
          if (popup) {
            popup.location.href = permanentPdfUrl;
            showStatus('PDF opened in popup (allow popups if blocked)...', 'info');
          } else {
            // Last resort: try direct navigation
            window.location.href = permanentPdfUrl;
            showStatus('Downloading PDF... (check your downloads folder)', 'info');
          }
        }
      } else if (generatedPDF) {
        // Fallback to local PDF
        const buyerName = document.getElementById('buyerName').value.replace(/\s+/g, '_') || 'Unknown_Buyer';
        const filename = `Purchase_Agreement_${buyerName}_${dateStr.replace(/\//g, '-')}.pdf`;
        generatedPDF.save(filename);
        showStatus('PDF downloaded locally!', 'success');
      } else {
        showStatus('No PDF available. Please submit the form first.', 'error');
      }
    });

    // Print PDF with Chrome-specific fixes
    printBtn.addEventListener('click', async () => {
      if (permanentPdfUrl) {
        try {
          // Chrome-specific: Use fetch with proper headers
          const response = await fetch(permanentPdfUrl, {
            method: 'GET',
            credentials: 'omit',
            cache: 'no-cache'
          });
          
          if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            
            // Chrome-optimized print method
            const printWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
            
            if (printWindow) {
              printWindow.document.write(`
                <html>
                  <head>
                    <title>Purchase Agreement</title>
                    <style>
                      body { margin: 0; padding: 0; }
                      iframe { width: 100%; height: 100vh; border: none; }
                    </style>
                  </head>
                  <body>
                    <iframe src="${url}" onload="setTimeout(() => { window.print(); }, 1000);"></iframe>
                  </body>
                </html>
              `);
              printWindow.document.close();
              
              // Cleanup after print
              setTimeout(() => {
                window.URL.revokeObjectURL(url);
              }, 5000);
            } else {
              throw new Error('Popup blocked');
            }
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
        } catch (error) {
          console.log('Direct print failed, trying popup method:', error);
          
          // Fallback: Simple popup for Chrome
          const popupFeatures = 'width=1000,height=700,scrollbars=yes,resizable=yes,toolbar=yes';
          const popup = window.open(permanentPdfUrl, '_blank', popupFeatures);
          
          if (popup) {
            showStatus('PDF opened in new window for printing (use Ctrl+P to print)...', 'info');
          } else {
            showStatus('Popup blocked! Please disable popup blocker and try again.', 'error');
          }
        }
      } else if (generatedPDF) {
        // Fallback to local PDF
        const pdfBlob = generatedPDF.output('blob');
        const pdfUrl = URL.createObjectURL(pdfBlob);
        const printWindow = window.open(pdfUrl);
        if (printWindow) {
          printWindow.onload = () => {
            printWindow.print();
          };
        }
      } else {
        showStatus('No PDF available for printing.', 'error');
      }
    });

    // Focus management
    document.querySelectorAll('.field-input').forEach(input => {
      input.addEventListener('focus', function() {
        this.style.background = 'rgba(255, 255, 240, 0.5)';
      });
      
      input.addEventListener('blur', function() {
        this.style.background = 'transparent';
      });
    });
  </script>
</body>
</html>
